<!DOCTYPE html>
<html lang="en">

<head>
    <base href="/riders-tracking/">
    <script>window.onerror = function (e) { console.error(e); };</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Riders Tracking | Real-time Partner GPS</title>
    <meta name="description" content="Track your riding partners in real-time.">
    <meta name="theme-color" content="#0a0b10">

    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>

<body>

    <div id="map"></div>

    <!-- APP DRAWER (Sidebar) -->
    <div id="app-drawer" class="app-drawer">
        <div class="drawer-header">
            <div class="drawer-user-info">
                <div class="avatar-circle">üë§</div>
                <div class="user-details">
                    <h3 id="drawer-user-name">Rider</h3>
                    <span id="drawer-user-status" style="color:var(--success); font-size:0.8rem;">Online</span>
                </div>
            </div>
            <button id="close-drawer-btn" style="background:none; border:none; color:white; font-size:2rem;">√ó</button>
        </div>

        <div class="drawer-content">
            <div class="section-title">MY PROFILE</div>
            <div class="input-group">
                <label>Display Name</label>
                <input type="text" id="edit-name" placeholder="Your Name" class="std-input">
            </div>
            <div class="input-group">
                <label>Bike Model</label>
                <input type="text" id="edit-bike" placeholder="e.g. Duke 390" class="std-input">
            </div>

            <div class="section-title">VEHICLE MODE</div>
            <div class="vehicle-grid">
                <button class="v-btn active" data-v="motorcycle"
                    onclick="selectDrawerVehicle('motorcycle')">üèçÔ∏è</button>
                <button class="v-btn" data-v="car" onclick="selectDrawerVehicle('car')">üöó</button>
                <button class="v-btn" data-v="bicycle" onclick="selectDrawerVehicle('bicycle')">üö≤</button>
                <button class="v-btn" data-v="walk" onclick="selectDrawerVehicle('walk')">üö∂</button>
            </div>

            <button id="save-profile-btn" class="btn btn-primary" style="width:100%; margin-top:20px;">UPDATE
                PROFILE</button>
            
            <div class="section-title" style="margin-top:30px; cursor:pointer; display:flex; justify-content:space-between; align-items:center;" id="toggle-ride-history">
                üìã RIDE HISTORY
                <span id="history-toggle-icon" style="font-size:0.8rem;">‚ñº</span>
            </div>
            <div id="ride-history-list" style="display:none; max-height:300px; overflow-y:auto; margin-top:10px;">
                <div id="no-rides-msg" style="text-align:center; color:#888; padding:20px; font-size:0.9rem;">No rides yet</div>
            </div>
        </div>

        <div class="drawer-footer">
            <button id="sign-out-btn" class="btn"
                style="width:100%; background:rgba(255, 77, 77, 0.2); color:#ff4d4d; border:1px solid #ff4d4d;">
                Sign Out
            </button>
            <div style="text-align:center; margin-top:10px; color:#444; font-size:0.7rem;">v1.2.0 Beta</div>
        </div>
    </div>

    <!-- RIDE SETUP MODAL (Create or Join) -->
    <div id="ride-setup-modal" class="modal" style="display:none; z-index:9100; pointer-events:auto;">
        <div class="setup-card" style="max-width:360px; margin:0 auto; padding:35px 25px; border-radius:28px; background:var(--card-bg); box-shadow: 0 10px 50px rgba(0,0,0,0.8);">
            <h2 style="text-align:center; margin-bottom:10px; font-weight:800; font-size:1.6rem;">üèçÔ∏è Your Squad</h2>
            <p style="text-align:center; color:#888; margin-bottom:30px; font-size:0.9rem;">Create a new ride or join your friends</p>
            
            <div style="display:flex; flex-direction:column; gap:15px;">
                <button id="create-new-ride-btn" class="btn btn-primary" style="width:100%; padding:14px; font-size:1rem; font-weight:600;">
                    ‚ûï CREATE NEW RIDE
                </button>
                
                <div style="text-align:center; color:#666; font-size:0.9rem;">‚Äî OR ‚Äî</div>
                
                <button id="join-existing-ride-btn" class="btn" style="width:100%; padding:14px; font-size:1rem; font-weight:600; background:#2a2d36; border:1px solid rgba(0, 242, 255, 0.3);">
                    ü§ù JOIN EXISTING RIDE
                </button>
            </div>
            
            <p style="text-align:center; color:#666; margin-top:20px; font-size:0.75rem;">Ask your friend for their ride code</p>
        </div>
    </div>

    <!-- JOIN RIDE MODAL -->
    <div id="join-modal" class="modal" style="display:none; z-index:9000; pointer-events:auto;">
        <div class="setup-card"
            style="max-width:320px; margin:0 auto; padding:25px; border-radius:20px; background:var(--card-bg); box-shadow: 0 10px 50px rgba(0,0,0,0.8);">
            <h3 style="margin-bottom:15px; text-align:center;">Join a Squad ü§ù</h3>
            <p style="text-align:center; color:#888; margin-bottom:20px; font-size:0.9rem;">Enter the code shared by
                your friend</p>

            <div class="input-group">
                <input type="text" id="input-ride-code" placeholder="SQUAD-CODE" class="std-input"
                    style="text-align:center; letter-spacing:2px; font-weight:bold; text-transform:uppercase;">
            </div>

            <button id="submit-join-btn" class="btn btn-primary" style="width:100%; margin-top:15px;">JOIN NOW</button>
            <button id="cancel-join-btn" class="btn"
                style="width:100%; margin-top:10px; background:transparent; border:1px solid #444; color:#aaa;">Cancel</button>
        </div>
    </div>

    <!-- LOGIN MODAL (Simplified) -->
    <div id="login-modal" class="modal active" style="display:block; z-index:9999; pointer-events:auto;">
        <div class="setup-card"
            style="max-width:340px; margin:0 auto; padding:35px 25px; border-radius:28px; background:var(--card-bg); box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
            <h2 style="text-align:center; margin-bottom:10px; font-weight:800; font-size:1.8rem;">Riders Tracking</h2>
            <p style="text-align:center; color:#888; margin-bottom:30px; font-size:0.95rem;">Login to track your squad
                üèçÔ∏è</p>

            <div class="social-login-grid" style="display:flex; flex-direction:column; gap:15px;">
                <button id="apple-login-btn" class="btn"
                    style="background:white; color:black; font-weight:600; display:flex; align-items:center; justify-content:center; padding:12px; transition:transform 0.1s;">
                    <span style="font-size:1.4rem; margin-right:12px; margin-top:-3px;">Ô£ø</span>
                    <span style="font-family:-apple-system, sans-serif;">Sign in with Apple</span>
                </button>

                <button id="google-login-btn" class="btn"
                    style="background:white; color:black; font-weight:600; display:flex; align-items:center; justify-content:center; padding:12px; transition:transform 0.1s;">
                    <span style="font-weight:bold; color:#4285F4; margin-right:12px; font-size:1.3rem;">G</span>
                    <span>Sign in with Google</span>
                </button>
            </div>

            <p id="login-status"
                style="text-align:center; color:var(--warning); margin-top:25px; font-size:0.8rem; min-height:1rem;">
            </p>
        </div>
    </div>

    <!-- UI Overlay -->
    <div class="overlay-ui">
        <div class="top-bar">
            <div style="display:flex; align-items:center; gap:15px;">
                <button id="menu-btn" class="menu-btn">‚ò∞</button>
                <div class="status-indicator">
                    <div class="dot" id="connection-dot"></div>
                    <span id="status-text">OFFLINE</span>
                </div>
            </div>
            <div class="ride-info">
                <div class="stat-label">Ride Code</div>
                <div class="ride-code" id="display-ride-code">----</div>
            </div>
        </div>

        <div class="map-tools">
            <div id="traffic-btn" class="tool-btn">üö¶</div>
            <button class="tool-btn" id="recenter-btn">üéØ</button>
            <button class="tool-btn" id="theme-toggle-btn">üåì</button>
            <button class="tool-btn" id="zoom-fit-btn">‚õ∂</button>
        </div>

        <div id="nav-mode-selector" class="nav-bar" style="display: none;">
            <button class="mode-btn active" data-mode="motorcycle">üèçÔ∏è</button>
            <button class="mode-btn" data-mode="car">üöó</button>
        </div>

        <div id="nav-panel" class="nav-panel" style="display: none;">
            <div class="nav-header">
                <h3>Navigation</h3><button class="close-btn" id="close-nav-panel">√ó</button>
            </div>
            <div class="nav-inputs">
                <div class="nav-input-group">
                    <span class="input-icon">üü¢</span>
                    <input id="source-input" placeholder="Start Location" readonly>
                    <button id="use-current-location" class="use-current-btn" title="Current Location">üéØ</button>
                </div>
                <div class="nav-input-group">
                    <span class="input-icon">üî¥</span>
                    <input id="destination-input" placeholder="Search Destination">
                </div>
                <div id="search-results" class="search-results"></div>
            </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button id="start-navigation-btn" class="btn btn-primary" style="flex:1;">GO</button>
                <button id="cancel-nav-setup-btn" class="btn" style="flex:1; background:#2a2d36; border:1px solid rgba(255,255,255,0.2);">CANCEL</button>
            </div>
        </div>

        <div class="bottom-controls">
            <div class="stats-grid">
                <div class="stat-card"><span class="stat-value" id="current-speed">0</span><span
                        class="stat-label">KM/H</span></div>
                <div class="stat-card"><span class="stat-value" id="distance-covered">0</span><span
                        class="stat-label">DIST</span></div>
            </div>
            <div class="action-buttons">
                <!-- SOS Button (Small) -->
                <button class="btn btn-sos" id="sos-btn"
                    style="flex:0 0 auto; width:50px; padding:0; display:flex; align-items:center; justify-content:center;">üÜò</button>

                <!-- Main Actions (Side-by-Side) -->
                <button class="btn" id="join-ride-btn"
                    style="flex:1; background:#2a2d36; border:1px solid rgba(255,255,255,0.2);">ü§ù JOIN</button>
                <button class="btn btn-navigate" id="navigate-btn" style="flex:1;">üß≠ NAVIGATE</button>
            </div>
            <div id="trip-info-sheet" class="trip-sheet" style="display: none;">
                <div class="trip-summary">
                    <div><span id="trip-distance-left">--</span> km</div>
                    <div><span id="trip-eta">--</span> min</div>
                </div>
                <button class="btn btn-danger" id="exit-nav-btn">EXIT</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="app.js"></script>
</body>

</html>